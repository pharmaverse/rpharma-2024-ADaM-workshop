---
title: "R/Pharma ADaM Workshop"
author: 
  - Fanny Gautier Cytel
  - Ben Straub GSK
  - Edoardo Mancini Roche 
  - Sadchla Mascary Gilead
date: 2024-10-25
date-format: full
format: 
  revealjs:
    theme: solarized
editor: 
  markdown: 
    wrap: 72
---

```{r}
#| include: false
library(glue)
library(countdown)
library(link)

link::auto(keep_pkg_prefix = FALSE,
           keep_braces = FALSE)

# Package hexes
metacore_img <- "https://raw.githubusercontent.com/atorus-research/metacore/master/man/figures/metacore.PNG"
metatools_img <- "https://raw.githubusercontent.com/pharmaverse/metatools/master/man/figures/metatools.png"
xportr_img <- "https://raw.githubusercontent.com/atorus-research/xportr/master/man/figures/logo.png"
admiral_img <- "https://raw.githubusercontent.com/pharmaverse/admiral/master/man/figures/logo.png"
pharmaverse_img <- "https://raw.githubusercontent.com/pharmaverse/pharmaverse-pkg/master/man/figures/banner.png"
dplyr_img <- "https://raw.githubusercontent.com/tidyverse/dplyr/master/man/figures/logo.png"

# Set image sizes
img_bullet_size <- 80
img_right_size <- 150
img_center_size <- 300

```

## Objectives

-   By the end of this workshop you will have:
    -   Updated code for ADaMs `ADSL` and `ADVS` using `pharmaverse`
        packages, `tidyverse` packages, base R and Pinnacle21-like
        specs.
    -   Gained an understanding of how to use `pharmaverse` packages
    -   Gained an understanding of how to use resources for building
        ADaMs in `R`.

## Play by Play

🕙10:05 - 10:15 Introductions and Setup

🕙10:15 - 10:30 Overview of pharmaverse `packages` and functions

🕥10:30 - 11:20 `ADSL`

🕚11:20 - 11:30 Break

🕦11:30 - 12:30 `ADVS`

🕐12:30 - 1:00 Questions and Resources

# Introductions and Setup

🕙10:00 - 10:10

## Who will help you achieve the objective!

> > -   `Fanny Gautier` - `presenting on ADVS` 📣
> > -   `Ben Straub` - `presenting on ADSL and pharmaverse packages` 📣
> > -   `Edoardo Mancini` - `Chat Support` 💻
> > -   `Sadchla Mascary` - `Chat Support` 💻

## Setting up your Workspace

-   **Preferred**:

    -   Sign up for a free [Posit Account](https://posit.cloud/)

    -   Share Link for R/Pharma: ADaM Workshop

        -   Everything loaded (data, packages, specs) and ready to go!

-   **Advanced:**

    -    Clone
        [Repo](https://github.com/pharmaverse/rpharma-2024-ADaM-workshop)
        and set up yourself

## How we will "code" today

-   Fanny and I will walk you through coding `ADSL` and `ADVS`
    -   Lite Discussion on each function
    -   Fill in the blank!
    -   Occasional Zoom Poll
-   Important to move along quickly
    -   Please post questions to chat
    -   Full scripts are available

# Overview of pharmaverse packages and functions

🕥10:15 - 10:30\

## The core pharmaverse packages

-   `metacore`
    `r glue("<img src={metacore_img} height='{img_bullet_size}'/>")`
-   `metatools`
    `r glue("<img src={metatools_img} height='{img_bullet_size}'/>")`
-   `xportr`
    `r glue("<img src={xportr_img} height='{img_bullet_size}'/>")`
-   `admiral`
    `r glue("<img src={admiral_img} height='{img_bullet_size}'/>")`

## The core tidyverse packages

-   `dplyr`
    `r glue("<img src={dplyr_img} height='{img_bullet_size}'/>")`
-   `stringr`
    `r glue("<img src={dplyr_img} height='{img_bullet_size}'/>")`
-   `haven`
    `r glue("<img src={dplyr_img} height='{img_bullet_size}'/>")`
-   `lubridate`
    `r glue("<img src={dplyr_img} height='{img_bullet_size}'/>")`

## Hello pharmaverse Functions! {.smaller}

| Package                     | Function                                                   | Purpose                                 |
|------------------|--------------------------------|----------------------|
| `r link::to_pkg("admiral")` | `r link::to_call("admiral::derive_vars_merged()")`         | `left_join` on steroids                 |
| `r link::to_pkg("admiral")` | `r link::to_call("admiral::derive_param_computed()")`      | Core function for wrappers used in ADVS |
| `r link::to_pkg("admiral")` | `r link::to_call("admiral::convert_blanks_to_na()")`       | SAS blanks versus R `NAs`               |
| `r link::to_pkg("admiral")` | `r link::to_call("metatools::combine_supp()")`             | Join Parent and Supplementary Datasets  |
| `r link::to_pkg("admiral")` | `r link::to_call("metatools::create_var_from_codelist()")` | Create Numeric Variables from Spec      |

## Hello pharmaverse Functions! {.smaller}

| Package                       | Function                                              | Purpose                                 |
|------------------|--------------------------------|----------------------|
| `r link::to_pkg("metatools")` | `r link::to_call("admiral::derive_vars_dt()")`        | `left_join` on steroids                 |
| `r link::to_pkg("metatools")` | `r link::to_call("admiral::derive_param_computed()")` | Core function for wrappers used in ADVS |
| `r link::to_pkg("metatools")` | `r link::to_call("admiral::convert_blanks_to_na()")`  | SAS blanks versus R `NAs`               |
| `r link::to_pkg("xportr")`    | `r link::to_call("metatools::combine_supp()")`        | Join Parent and Supplementary Datasets  |
| `r link::to_pkg("xportr")`    | `r link::to_call("xportr::xportr_write()")`           | Create Numeric Variables from Spec      |

## Hello Specs!

-   

# `ADSL`

🕥10:30 - 11:20

## Helpful Resources

-   admiraldiscovery
-   pgkdown sites for xportr, metatools, metacore and admiral
-   ?? TODO: link these out
-   pharmaverse slack
-   pharmaverse examples
-   Extension packages for admiral

## Some things to ponder...

-   Blanks versus NAs
-   Default Arguments and `NULL` Arguments
-   Viewing mini-datasets
-   How to find the functions (discovery versus package documentation)
-   Outline in the Code

## Blanks in the code!

-   What to expect?
-   

## Packages Walkthrough - brief intro!

> > -   `metacore`
> >     `r glue("<img src={metacore_img} height='{img_bullet_size}'/>")`
> > -   `metatools`
> >     `r glue("<img src={metatools_img} height='{img_bullet_size}'/>")`
> > -   `xportr`
> >     `r glue("<img src={xportr_img} height='{img_bullet_size}'/>")`
> > -   `admiral`
> >     `r glue("<img src={admiral_img} height='{img_bullet_size}'/>")`

## Packages Walkthrough - metacore

## Packages Walkthrough - metatools

## Packages Walkthrough - xportr

## Packages Walkthrough - admiral

## Packages Walkthrough - example usage

## ADSL Walkthrough

-   We are going to code ADSL
-   Parts of the code are blank out and will require some quick research
-   Don't worry if you get lost we will get you back on track

```{r}
countdown(minutes = 50, seconds = 00, 
          top = NULL, bottom = 0,
          left = NULL, right = 0,
          margin = "10%",
          font_size = "2.5em")
```

## ADVS Walkthrough

-   We are going to code ADVS
-   Parts of the code are blank out and will require some quick research
-   Don't worry if you get lost we will get you back on track

```{r}
countdown(minutes = 50, seconds = 00, 
          top = NULL, bottom = 0,
          left = NULL, right = 0,
          margin = "10%",
          font_size = "2.5em")
```

## `admiral` exercises `r glue("<img src={admiral_img} align='right' height='{img_right_size - 20}'/>")`

```{r}
#| eval: false
#| echo: true

library(admiral)
library(dplyr, warn.conflicts = FALSE)
library(pharmaversesdtm)
library(lubridate)
library(stringr)

data("dm")
data("ds")
data("ex")
data("ae")

dm <- convert_blanks_to_na(dm)
ds <- convert_blanks_to_na(ds)
ex <- convert_blanks_to_na(ex)
ae <- convert_blanks_to_na(ae)
```

## `admiral` exercises - 1 `r glue("<img src={admiral_img} align='right' height='{img_right_size-20}'/>")` {.smaller}

-   Create a new dataset `ds_ext` with all of the `ds`, plus derive a
    numeric date version of `DS.DSSTDTC` without any imputation as
    `DSSTDT`.\
    *Hint: `derive_vars_dt()`*

```{r}
countdown(minutes = 10, seconds = 00, 
          top = NULL, bottom = 0,
          left = NULL, right = 0,
          margin = "10%",
          font_size = "2.5em")
```

## `admiral` exercises - 2 `r glue("<img src={admiral_img} align='right' height='{img_right_size-20}'/>")` {.smaller}

-   Create a new dataset `adsl_1` with all of `dm`, plus derive an end
    of study date (`EOSDT`) using the `DSSTDT` from `ds_ext` where
    `DSCAT == "DISPOSITION EVENT" & DSDECOD != "SCREEN FAILURE"`.\
    *Hint: `derive_vars_merged()`*

```{r}
countdown(minutes = 10, seconds = 00, 
          top = NULL, bottom = 0,
          left = NULL, right = 0,
          margin = "10%",
          font_size = "2.5em")
```

::: aside
[Solution](https://pharmaverse.github.io/admiral/cran-release/articles/adsl.html#disposition){.external
target="_blank"}
:::

## `admiral` exercises - 3 `r glue("<img src={admiral_img} align='right' height='{img_right_size-20}'/>")` {.smaller}

-   Create a new dataset `adsl_2` with all of `adsl_1`, plus derive a
    safety population flag (`SAFFL`) as `Y` for any patient from `ex`
    with a record where `EXDOSE > 0`.\
    *Hint: `derive_var_merged_exist_flag()`*

```{r}
countdown(minutes = 10, seconds = 00, 
          top = NULL, bottom = 0,
          left = NULL, right = 0,
          margin = "10%",
          font_size = "2.5em")
```

::: aside
[Solution](https://pharmaverse.github.io/admiral/cran-release/articles/adsl.html#popflag){.external
target="_blank"}
:::

## `admiral` exercises - 4 `r glue("<img src={admiral_img} align='right' height='{img_right_size-20}'/>")` {.smaller}

-   Create a new dataset `adsl_3` with all of `adsl_2`, plus derive a
    last known alive date (`LSTALVDT`) as the latest date of the
    following variables from `ae`: `AESTDTC` and `AEENDTC`, imputing
    missing day and month to the first.\
    *Hint: `derive_var_extreme_dt()`*

```{r}
countdown(minutes = 10, seconds = 00, 
          top = NULL, bottom = 0,
          left = NULL, right = 0,
          margin = "10%",
          font_size = "2.5em")
```

::: aside
[Solution](https://pharmaverse.github.io/admiral/cran-release/articles/adsl.html#lstalvdt){.external
target="_blank"}
:::

## `admiral` exercises - 5 `r glue("<img src={admiral_img} align='right' height='{img_right_size-20}'/>")` {.smaller}

-   If time permits, explore [higher order
    functions](https://pharmaverse.github.io/admiral/cran-release/articles/higher_order.html)
    that give greater flexibility to all `admiral` functions

```{r}
countdown(minutes = 10, seconds = 00, 
          top = NULL, bottom = 0,
          left = NULL, right = 0,
          margin = "10%",
          font_size = "2.5em")
```

## Closing Thoughts {.smaller}

> -   Anyone can be become a `pharmaverse champion` as one of the
>     criteria we look for in `pharmaverse` recommended packages is
>     great user guides, as hopefully demonstrated wit the sites shown
>     today
> -   We were only able to show a small number of pharmaverse packages
>     today, but please delve deeper to explore the full breadth
> -   If you'd like to contribute to `pharmaverse`, check out options at
>     [pharmaverse.org](https://pharmaverse.org/contribute/)
> -   Finally, be sure to join our community on
>     [Slack!](https://join.slack.com/t/pharmaverse/shared_invite/zt-yv5atkr4-Np2ytJ6W_QKz_4Olo7Jo9A)
